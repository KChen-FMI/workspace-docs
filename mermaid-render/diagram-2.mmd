flowchart TD

%%==============================
%% START: PC側は常時Entraで前準備
%%==============================
S((START)) --> A1

subgraph 常時運用[常時運用：EntraでPC前準備（AD不関与）]
    A1[PCをEntra Join]
    A1 --> A2[Intune管理下に登録]
    A2 --> A3[デバイス共通アプリ配布]
    A3 --> A4[DoD実行（ユーザ痕跡ゼロ化）]
    A4 --> A5[待機PC（誰もログインしていない）]
end

%%==============================
%% EVENT: 新ユーザ入社
%%==============================
A5 -. イベント .-> E1((新ユーザ入社))

subgraph ユーザ側[ユーザ確定後]
    E1 --> B1[Entra IDにユーザ作成]
    B1 --> B2[必要に応じてADにもユーザ作成]
    B2 --> B3[ユーザをPCにアサイン]
    B3 --> B4[ユーザがEntra IDでPCに初回ログイン]
    B4 --> B5[ユーザ依存設定適用]
end

%%==============================
%% ADリソース利用（イベント駆動）
%%==============================
C1["AD管理下リソース<br/>(ファイルサーバ / Wi-Fi / プリンタ)"]
B4 -. アクセス .-> C1
C1 --> C2[AD認証]
